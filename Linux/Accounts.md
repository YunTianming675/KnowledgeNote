# 用户、组

## 使用者识别码

UID

- UID 范围不同，含义不同：
  - 0：系统管理员
  - 1～999：系统用户
  - 1000～60000：可登陆账户
- 相关文件：`/etc/passwd` 
  - 以冒号分隔为 7 列，一行则代表一个账号的信息，每一列分别代表用户名、密码、UID、GID、描述、用户目录、登陆 shell
  - 密码在 `/etc/shadow` 中，所以这里会显示一个 `x` 
  - 修改这里的用户目录可以修改登陆时默认进入的目录

GID

- 相关文件：`/etc/group` 
  - 以冒号分隔为 4 列，分别是：组名、组密码、组 ID、在此组的账号
  - 组密码同样显示为 `x` 
  - 将账号名加入第四个字段即代表将某个账号加入这个组
  - 初始群组不加入第四个字段，所以不显示 root 在 root 组里

> 账户密码的保存位置：/etc/shadow

## /etc/shadow 文件

以冒号分隔为 9 个字段

1. 账号名称
2. 密码，显示的是被加密后的样子
3. 最近改动密码的日期，以 1970 年 1 月 1 日开始计算的天数
4. 密码不可被改动的天数
5. 密码需要变更的天数，表示最多过了多少天需要变更密码
6. 密码变更期限前的警告天数
7. 密码失效时间。在第 5 字段的时间过后，密码进入失效状态，此时通过 shell 登陆，系统将强制要求修改密码。如果在这个时间后密码依然未更新，则进入失效状态，此时该账号不可登录
8. 账号失效日期，该时间过后，不管密码是否失效，该账号都不可使用。可用于收费服务的系统中
9. 保留

- root 密码忘了怎么办
  - 重启进入单人维护模式，此时系统会给予一个 root 权限的 shell，使用 `passwd` 修改密码即可
  - Live CD 开机后挂载根目录，修改 `/etc/shadow` 文件，将密码字段清空。重新进入系统后，root 无需密码即可登陆，使用 `passwd` 修改密码

> 查看密码的加密算法：`# authconfig --test | grep hashing` 

## 初始群组、有效群组

初始群组：在 `/etc/passwd` 中的 GID 字段所代表的组

- 初始群组表示使用者一登陆即会获得

有效群组：`groups` 指令列出的第一个群组

- 这也是创建文件或目录时默认的群组

修改有效群组：newgrp

- 只能修改到账户所在的组
- 相当于在一个新的 shell 中重新计算账户组权限，所以使用后记得 `exit` 

## /etc/gshadow 文件

- 以冒号分隔为 4 个字段：组名、密码栏、组管理员账号、在这个组里的账号
- 密码栏以 `!` 开头表示没有合法密码

> 组管理员：组管理员可以在没有 root 权限的情况下将某一个账号加入自己所在的组

# 账号管理

## 添加账户：useradd

- 具体解释见 [指令](./CentOS/02_指令.md) 
- 私有群组机制和公共群组机制：
  - 私有：创建用户时，默认创建一个与用户名相同的组，并将主文件夹权限设置为 700，而非使用 `useradd -D` 中的 GROUP 选项
  - 公共：创建用户时，使用相同的组 GID=100
- 默认的 `SKEL=/etc/skel` 选项：
  - 该选项表示创建主目录的模板，即将这个文件夹的内容复制到新建的主文件夹内
  - 修改这里的 `.bashrc` 文件可让新建的账户拥有自定义的内容

示例：添加一个账户，该账户使用默认密码登陆后必须修改密码才能再次登陆

```
# useradd agetest
# echo "agetest" | passwd --stdin agetest
# chage -d 0 agetest
```

## 删除账户

- userdel 可以直接删除用户，但用户往往不只有主文件夹内的数据，可以使用 `fine / -user username` 找出所有该用户的数据并删除，再执行删除用户操作